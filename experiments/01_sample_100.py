import pandas as pd
from pandas import DataFrame

from global_values import models, datasets

if __name__ == '__main__':
    '''Randomly samples 100 'correct' answers for further analysis in later steps. Only questions that have been 
    answered correctly by all models will be preserved'''
    for dataset_name in datasets:
        union_df: DataFrame = None
        for model_name in models:
            df: DataFrame = pd.read_csv(f'data/outputs/{dataset_name}/{model_name}/step_0_raw_mcqa_performance_normed.csv', index_col='question_idx')
            # if dataset_name == 'medqa':
            df = df.drop(df.columns[0], axis=1)   # Drop the unnamed autogenerated column from the step 0 runs
            df = df[df['base_answer_correct'] == True]
            if union_df is None:
                union_df = df
            else:
                union_df = df.loc[df.index.isin(union_df.index)] # Equivalent of an inner exist join on question_idx

        union_df = union_df.drop_duplicates()
        union_df.sample(100).to_csv(f'data/outputs/{dataset_name}/step_1_mcqa_all_models_correct_sample.csv')

